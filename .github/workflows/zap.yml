name: Zap

on:
    workflow_call:

permissions:
    issues: write
    packages: read
jobs:
    zap:
        services:
            vampi:
                image: ghcr.io/ghcr.io/molocohrrr/vampi:ci
                credentials:
                    username: ${{ github.repository_owner }}
                    password: ${{ secrets.GITHUB_TOKEN }}
                ports:
                    - 5000:5000
        runs-on: ubuntu-latest
        steps:
            - name: Zap Baseline
              uses: grisolfi/action-baseline@141ae0a3343b2fe4109b46385229e4edc07a9e35
              with:
                target: http://localhost:5000
                allow_issue_writing: false
            - name: Zap Full Scan
              if: ${{ github.event_name == 'push' && github.base_ref == 'master'}}
              uses: zaproxy/action-full-scan@2caa057f6970472f2f7e9ea9d9b24079dddbded5
              with:
                target: http://localhost:5000
                allow_issue_writing: true